---
import { getCollection } from 'astro:content';
import { getPaddingClass } from '@utils/styleUtils';
import type { PaddingSize } from '@utils/styleUtils';
import { Image } from 'astro:assets';
import { Mail } from 'lucide-astro';
import Linkedin from '../icons/linkedin.astro';
import { Icon } from 'astro-icon/components';
import benjaminImg from '../../content/team/images/benjamin.jpg';
import tinaImg from '../../content/team/images/tina.png';
import manishImg from '../../content/team/images/manish.jpg';
import bivobImg from '../../content/team/images/bivob.jpeg';

interface Props {
    padding?: PaddingSize;
    paddingTop?: PaddingSize;
    paddingBottom?: PaddingSize;
}

const { padding, paddingTop, paddingBottom } = Astro.props;
const paddingClass = getPaddingClass({ padding, paddingTop, paddingBottom });

const teamMembers = await getCollection('team', ({ data }) => {
    return data.publish !== false;
});

// Sort team members by order
const sortedTeamMembers = teamMembers.sort((a, b) => a.data.order - b.data.order);

// Separate founders, team leads, and other team members
const founders = sortedTeamMembers.filter(
    (member) => member.data.jobTitle?.toLowerCase().includes('founder')
);
const leads = sortedTeamMembers.filter(
    (member) =>
        /chief technology officer|cto|chief design officer|cdo/i.test(member.data.jobTitle || '') &&
        !member.data.jobTitle?.toLowerCase().includes('founder')
);
const othersInTech = sortedTeamMembers.filter(
    (member) =>
        !member.data.jobTitle?.toLowerCase().includes('founder') &&
        !(/chief technology officer|cto|chief design officer|cdo/i.test(member.data.jobTitle || '')) &&
        member.data?.team === 'technology'
);
const othersInOps = sortedTeamMembers.filter(
    (member) =>
        !member.data.jobTitle?.toLowerCase().includes('founder') &&
        !(/chief technology officer|cto|chief design officer|cdo/i.test(member.data.jobTitle || '')) &&
        member.data.team === 'operations'
);

const localImageMap: Record<string, any> = {
  'benjamin.jpg': benjaminImg,
  'tina.png': tinaImg,
  'manish.jpg': manishImg,
  'bivob.jpeg': bivobImg,
};

// Helper to resolve image for founders/leads
function resolveImage(headshot: any) {
  if (typeof headshot === 'string' && headshot.startsWith('./images/')) {
    const key = headshot.replace('./images/', '');
    return localImageMap[key] || headshot;
  }
  return headshot;
}
---

<section class:list={["relative", paddingClass]}>
    <div class="site-container mx-auto px-4">
        {founders.length > 0 && (
            <>
                <h2 class="text-3xl md:text-4xl font-medium text-center mb-2 tracking-tight text-primary">Meet Our Founders</h2>
                {/* <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" /> */}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                    {founders.map((member, index) => (
                        <div
                            class="flex flex-col items-center rounded-2xl p-8"
                            data-aos="fade-up"
                            data-aos-delay={index * 100}
                            data-aos-duration="800"
                        >
                            <div class="relative mb-4 flex items-center justify-center w-40 h-40 md:w-56 md:h-56 rounded-full bg-transparent">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={192}
                                        height={192}
                                        quality={90}
                                        format="webp"
                                        class="rounded-full object-cover w-36 h-36 md:w-44 md:h-44"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-36 h-36 md:w-56 md:h-56 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                            <h3 class="text-2xl font-semibold text-primary mb-1 text-center">{member.data.name}</h3>
                            <p class="text-base text-gray-500 mb-2 text-center">{member.data.jobTitle}</p>
                            {member.data.email && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <a href={`mailto:${member.data.email}`} aria-label="Email" class="text-gray-700 hover:text-primary">
                                        <Mail size={20} strokeWidth={1.5} />
                                    </a>
                                </div>
                            )}
                            {member.data.linkedin && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <a href={member.data.linkedin} target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-blue-700 hover:text-blue-900">
                                        <Linkedin size={20} />
                                    </a>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            </>
        )}
        {leads.length > 0 && (
            <>
                <h2 class="text-3xl md:text-4xl font-medium text-center mb-2 mt-8 tracking-tight text-primary">Team Leads</h2>
                {/* <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" /> */}
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                    {leads.map((member, index) => (
                        <div
                            class="flex flex-col items-center rounded-2xl p-8"
                            data-aos="fade-up"
                            data-aos-delay={index * 100}
                            data-aos-duration="800"
                        >
                            <div class="relative mb-4 flex items-center justify-center w-40 h-40 md:w-56 md:h-56 rounded-full bg-transparent">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={192}
                                        height={192}
                                        quality={90}
                                        format="webp"
                                        class="rounded-full object-cover w-36 h-36 md:w-44 md:h-44"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-36 h-36 md:w-44 md:h-44 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                            <h3 class="text-2xl font-semibold text-primary mb-1 text-center">{member.data.name}</h3>
                            <p class="text-base text-gray-500 mb-2 text-center">{member.data.jobTitle}</p>
                            {member.data.email && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <a href={`mailto:${member.data.email}`} aria-label="Email" class="text-gray-700 hover:text-primary">
                                        <Mail size={20} strokeWidth={1.5} />
                                    </a>
                                </div>
                            )}
                            {member.data.linkedin && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <a href={member.data.linkedin} target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-blue-700 hover:text-blue-900">
                                        <Linkedin size={20} />
                                    </a>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            </>
        )}
        <div class="flex flex-col gap-4 items-center">
            <h2 class="text-3xl md:text-4xl font-semibold text-center mt-8 tracking-tight text-primary">Technology Team</h2>
            {/* <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" /> */}
            <div class="flex gap-16 justify-between w-full max-w-[72rem]">
                {othersInTech.map((member, index) => (
                    <div
                        class="flex flex-col group col-span-1 rounded-xl items-center"
                        data-aos="fade-up"
                        data-aos-delay={index * 100}
                        data-aos-duration="800"
                    >
                        <div class="pl-4 pr-2 py-4">
                            <div class="flex items-center justify-center w-32 h-32 md:w-40 md:h-40 rounded-full bg-transparent">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={96}
                                        height={96}
                                        quality={100}
                                        format="webp"
                                        class="rounded-full object-cover w-32 h-32 md:w-40 md:h-40"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div class="px-2 py-4 flex flex-col items-center flex-1">
                            <h3 class="text-base font-medium text-primary mb-1">{member.data.name}</h3>
                            <p class="text-sm text-gray-400 mb-2">{member.data.jobTitle}</p>
                            <div class="flex gap-4 mt-2 mb-2">
                                {member.data.linkedin && (
                                    <a href={member.data.linkedin} target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-blue-700 hover:text-blue-900">
                                        <Linkedin size={24} />
                                    </a>
                                )}
                                {member.data.email && (
                                    <a href={`mailto:${member.data.email}`} aria-label="Email" class="text-gray-700 hover:text-primary">
                                        <Icon name="mail" size={24} />
                                    </a>
                                )}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>

        <div>
            <h2 class="text-3xl md:text-4xl font-semibold text-center mb-4 mt-8 tracking-tight text-primary">Operations Team</h2>
            {/* <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" /> */}
            <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 xl:gap-x-8 xl:gap-y-14">
                {othersInOps.map((member, index) => (
                    <div
                        class="flex flex-col group col-span-2 rounded-xl items-center"
                        data-aos="fade-up"
                        data-aos-delay={index * 100}
                        data-aos-duration="800"
                    >
                        <div class="pl-4 pr-2 py-4">
                            <div class="flex items-center justify-center w-32 h-32 md:w-40 md:h-40 rounded-full bg-transparent">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={96}
                                        height={96}
                                        quality={80}
                                        format="webp"
                                        class="rounded-full object-cover w-32 h-32 md:w-40 md:h-40"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                        </div>
                        <div class="px-2 py-4 flex flex-col items-center flex-1">
                            <h3 class="text-base font-medium text-primary mb-1">{member.data.name}</h3>
                            <p class="text-sm text-gray-400 mb-2">{member.data.jobTitle}</p>
                            <div class="flex gap-4 mt-2 mb-2">
                                {member.data.linkedin && (
                                    <a href={member.data.linkedin} target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-blue-700 hover:text-blue-900">
                                        <Linkedin size={24} />
                                    </a>
                                )}
                                {member.data.email && (
                                    <a href={`mailto:${member.data.email}`} aria-label="Email" class="text-gray-700 hover:text-primary">
                                        <Icon name="mail" size={24} />
                                    </a>
                                )}
                            </div>
                        </div>
                    </div>
                ))}
            </div>
        </div>
    </div>
</section>
