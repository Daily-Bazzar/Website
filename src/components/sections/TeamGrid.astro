---
import { getCollection } from 'astro:content';
import { getPaddingClass } from '@utils/styleUtils';
import type { PaddingSize } from '@utils/styleUtils';
import { Image } from 'astro:assets';
import { Linkedin, Mail } from 'lucide-astro';
import benjaminImg from '../../content/team/images/benjamin.jpg';
import tinaImg from '../../content/team/images/tina.png';
import manishImg from '../../content/team/images/manish.jpg';
import bivobImg from '../../content/team/images/bivob.jpeg';

interface Props {
    padding?: PaddingSize;
    paddingTop?: PaddingSize;
    paddingBottom?: PaddingSize;
}

const { padding, paddingTop, paddingBottom } = Astro.props;
const paddingClass = getPaddingClass({ padding, paddingTop, paddingBottom });

const teamMembers = await getCollection('team', ({ data }) => {
    return data.publish !== false;
});

// Sort team members by order
const sortedTeamMembers = teamMembers.sort((a, b) => a.data.order - b.data.order);

// Separate founders, team leads, and other team members
const founders = sortedTeamMembers.filter(
    (member) => member.data.jobTitle?.toLowerCase().includes('founder')
);
const leads = sortedTeamMembers.filter(
    (member) =>
        /chief technology officer|cto|chief design officer|cdo/i.test(member.data.jobTitle || '') &&
        !member.data.jobTitle?.toLowerCase().includes('founder')
);
const others = sortedTeamMembers.filter(
    (member) =>
        !member.data.jobTitle?.toLowerCase().includes('founder') &&
        !(/chief technology officer|cto|chief design officer|cdo/i.test(member.data.jobTitle || ''))
);

const localImageMap: Record<string, any> = {
  'benjamin.jpg': benjaminImg,
  'tina.png': tinaImg,
  'manish.jpg': manishImg,
  'bivob.jpeg': bivobImg,
};

// Helper to resolve image for founders/leads
function resolveImage(headshot: any) {
  if (typeof headshot === 'string' && headshot.startsWith('./images/')) {
    const key = headshot.replace('./images/', '');
    return localImageMap[key] || headshot;
  }
  return headshot;
}
---

<section class:list={["relative", paddingClass]}>
    <div class="site-container mx-auto px-4">
        {founders.length > 0 && (
            <>
                <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-2 mt-8 tracking-tight text-primary">MEET OUR FOUNDERS</h2>
                <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" />
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                    {founders.map((member, index) => (
                        <div
                            class="flex flex-col items-center bg-white rounded-2xl shadow-xl p-8 border border-gray-100 hover:shadow-2xl transition-shadow duration-300"
                            data-aos="fade-up"
                            data-aos-delay={index * 100}
                            data-aos-duration="800"
                        >
                            <div class="relative mb-4 flex items-center justify-center w-40 h-40 md:w-48 md:h-48 rounded-full bg-primary/5 border border-gray-200">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={192}
                                        height={192}
                                        quality={90}
                                        format="webp"
                                        class="rounded-full object-cover w-36 h-36 md:w-44 md:h-44"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-36 h-36 md:w-44 md:h-44 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                            <h3 class="text-lg font-medium text-primary mb-1 text-center">{member.data.name}</h3>
                            <p class="text-base text-gray-700 mb-2 text-center">{member.data.jobTitle}</p>
                            {member.data.email && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m8 0a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                                    <a href={`mailto:${member.data.email}`} class="hover:underline">{member.data.email}</a>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            </>
        )}
        {leads.length > 0 && (
            <>
                <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-2 mt-8 tracking-tight text-primary">TEAM LEADS</h2>
                <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" />
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8 mb-16">
                    {leads.map((member, index) => (
                        <div
                            class="flex flex-col items-center bg-white rounded-2xl shadow-xl p-8 border border-gray-100 hover:shadow-2xl transition-shadow duration-300"
                            data-aos="fade-up"
                            data-aos-delay={index * 100}
                            data-aos-duration="800"
                        >
                            <div class="relative mb-4 flex items-center justify-center w-40 h-40 md:w-48 md:h-48 rounded-full bg-primary/5 border border-gray-200">
                                {member.data.headshot ? (
                                    <Image
                                        src={resolveImage(member.data.headshot)}
                                        alt={member.data.name}
                                        width={192}
                                        height={192}
                                        quality={90}
                                        format="webp"
                                        class="rounded-full object-cover w-36 h-36 md:w-44 md:h-44"
                                        loading="eager"
                                        decoding="async"
                                    />
                                ) : (
                                    <div class="w-36 h-36 md:w-44 md:h-44 rounded-full bg-gray-200 flex items-center justify-center">
                                        <span class="text-gray-400">No Image</span>
                                    </div>
                                )}
                            </div>
                            <h3 class="text-lg font-medium text-primary mb-1 text-center">{member.data.name}</h3>
                            <p class="text-base text-gray-700 mb-2 text-center">{member.data.jobTitle}</p>
                            {member.data.email && (
                                <div class="flex items-center justify-center gap-2 text-gray-600 text-sm mb-1">
                                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 12H8m8 0a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
                                    <a href={`mailto:${member.data.email}`} class="hover:underline">{member.data.email}</a>
                                </div>
                            )}
                        </div>
                    ))}
                </div>
            </>
        )}
        <h2 class="text-3xl md:text-4xl font-extrabold text-center mb-2 mt-8 tracking-tight text-primary">MEET OUR TEAM</h2>
        <div class="w-24 h-1 bg-pink-400 mx-auto mb-10 rounded-full" />
        <div class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-8 xl:gap-x-8 xl:gap-y-14">
            {others.map((member, index) => (
                <div
                    class="flex flex-row group bg-white rounded-xl shadow-md border border-gray-100 hover:shadow-xl transition-shadow duration-300 items-center"
                    data-aos="fade-up"
                    data-aos-delay={index * 100}
                    data-aos-duration="800"
                >
                    <div class="pl-4 pr-2 py-4">
                        <div class="flex items-center justify-center w-20 h-20 md:w-24 md:h-24 rounded-full bg-primary/5 border border-gray-200">
                            {member.data.headshot ? (
                                <Image
                                    src={resolveImage(member.data.headshot)}
                                    alt={member.data.name}
                                    width={96}
                                    height={96}
                                    quality={80}
                                    format="webp"
                                    class="rounded-full object-cover w-16 h-16 md:w-20 md:h-20"
                                    loading="eager"
                                    decoding="async"
                                />
                            ) : (
                                <div class="w-16 h-16 md:w-20 md:h-20 rounded-full bg-gray-200 flex items-center justify-center">
                                    <span class="text-gray-400">No Image</span>
                                </div>
                            )}
                        </div>
                    </div>
                    <div class="px-2 py-4 flex flex-col items-start flex-1">
                        <h3 class="text-base font-normal text-primary mb-1">{member.data.name}</h3>
                        <p class="text-sm text-gray-700 mb-2">{member.data.jobTitle}</p>
                        <div class="flex gap-4 mt-2 mb-2">
                            {member.data.linkedin && (
                                <a href={member.data.linkedin} target="_blank" rel="noopener noreferrer" aria-label="LinkedIn" class="text-blue-700 hover:text-blue-900">
                                    <Linkedin size={20} strokeWidth={1.5} />
                                </a>
                            )}
                            {member.data.email && (
                                <a href={`mailto:${member.data.email}`} aria-label="Email" class="text-gray-700 hover:text-primary">
                                    <Mail size={20} strokeWidth={1.5} />
                                </a>
                            )}
                        </div>
                    </div>
                </div>
            ))}
        </div>
    </div>
</section>
